(function(n){typeof define=="function"&&define.amd?define(["jquery","moment"],n):typeof exports=="object"?n(require("jquery"),require("moment")):n(jQuery,moment)})(function(n,t){function i(i,f){var e,o;this.element=i;this.options=n.extend(!0,{},r,f);this.options.events.length&&(this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(this.options.events):this.addMomentObjectToEvents(this.options.events));this.month=this.options.startWithMonth?t(this.options.startWithMonth).startOf("month"):t().startOf("month");this.options.constraints&&(this.options.constraints.startDate&&(e=t(this.options.constraints.startDate),this.month.isBefore(e,"month")&&(this.month.set("month",e.month()),this.month.set("year",e.year()))),this.options.constraints.endDate&&(o=t(this.options.constraints.endDate),this.month.isAfter(o,"month")&&this.month.set("month",o.month()).set("year",o.year())));this._defaults=r;this._name=u;this.init()}var u="clndr",r={template:"<div class='clndr-controls'>"+"<div class='clndr-control-button'><span class='clndr-previous-button'><i class='fa fa-angle-left'><\/i><\/span><\/div><div class='month'><%= month %> <%= year %><\/div><div class='clndr-control-button'><span class='clndr-next-button'><i class='fa fa-angle-right'><\/i><\/span><\/div>"+"<\/div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'>"+"<% for(var i = 0; i < daysOfTheWeek.length; i++) { %>"+"<td class='header-day'><%= daysOfTheWeek[i] %><\/td>"+"<% } %>"+"<\/tr><\/thead><tbody>"+"<% for(var i = 0; i < numberOfRows; i++){ %>"+"<tr>"+"<% for(var j = 0; j < 7; j++){ %>"+"<% var d = j + i * 7; %>"+"<td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %>"+"<\/div><\/td>"+"<% } %>"+"<\/tr>"+"<% } %>"+"<\/tbody><\/table>",weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null,constraints:null,forceSixRows:null};i.prototype.init=function(){if(this.daysOfTheWeek=this.options.daysOfTheWeek||[],!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var i=0;i<7;i++)this.daysOfTheWeek.push(t().weekday(i).format("dd").charAt(0))}if(this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)),!n.isFunction(this.options.render))if(this.options.render=null,typeof _=="undefined")throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");else this.compiledClndrTemplate=_.template(this.options.template);n(this.element).html("<div class='clndr'><\/div>");this.calendarContainer=n(".clndr",this.element);this.bindEvents();this.render();this.options.ready&&this.options.ready.apply(this,[])};i.prototype.shiftWeekdayLabels=function(n){for(var t=this.daysOfTheWeek,i=0;i<n;i++)t.push(t.shift());return t};i.prototype.createDaysObject=function(i){var s,u,f,o,h,r,e,c;if(daysArray=[],s=i.startOf("month"),this.eventsLastMonth=[],this.eventsThisMonth=[],this.eventsNextMonth=[],this.options.events.length&&(this.options.multiDayEvents?(this.eventsThisMonth=n(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===i.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===i.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=i.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=i.format("YYYY-MM")?!0:!1}).toArray(),this.options.showAdjacentMonths&&(u=i.clone().subtract(1,"months"),f=i.clone().add(1,"months"),this.eventsLastMonth=n(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===u.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===u.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=u.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=u.format("YYYY-MM")?!0:!1}).toArray(),this.eventsNextMonth=n(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===f.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===f.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=f.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=f.format("YYYY-MM")?!0:!1}).toArray())):(this.eventsThisMonth=n(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==i.format("YYYY-MM")}).toArray(),this.options.showAdjacentMonths&&(u=i.clone().subtract(1,"months"),f=i.clone().add(1,"months"),this.eventsLastMonth=n(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==u.format("YYYY-MM")}).toArray(),this.eventsNextMonth=n(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==f.format("YYYY-MM")}).toArray()))),o=s.weekday()-this.options.weekOffset,o<0&&(o+=7),this.options.showAdjacentMonths)for(r=0;r<o;r++)e=t([i.year(),i.month(),r-o+1]),daysArray.push(this.createDayObject(e,this.eventsLastMonth));else for(r=0;r<o;r++)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}));for(h=s.daysInMonth(),r=1;r<=h;r++)e=t([i.year(),i.month(),r]),daysArray.push(this.createDayObject(e,this.eventsThisMonth));for(r=1;daysArray.length%7!=0;)this.options.showAdjacentMonths?(e=t([i.year(),i.month(),h+r]),daysArray.push(this.createDayObject(e,this.eventsNextMonth))):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"})),r++;if(this.options.forceSixRows&&daysArray.length!==42)for(c=t(daysArray[daysArray.length-1].date).add(1,"days");daysArray.length<42;)this.options.showAdjacentMonths?(daysArray.push(this.createDayObject(t(c),this.eventsNextMonth)),c.add(1,"days")):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));return daysArray};i.prototype.createDayObject=function(n,i){var f=[],s=t(),h=this,u=0,c=i.length,e,o,r;for(u;u<c;u++)h.options.multiDayEvents?(e=i[u]._clndrStartDateObject,o=i[u]._clndrEndDateObject,(n.isSame(e,"day")||n.isAfter(e,"day"))&&(n.isSame(o,"day")||n.isBefore(o,"day"))&&f.push(i[u])):i[u]._clndrDateObject.date()==n.date()&&f.push(i[u]);return r="",s.format("YYYY-MM-DD")==n.format("YYYY-MM-DD")&&(r+=" today"),n.isBefore(s,"day")&&(r+=" past"),f.length&&(r+=" event"),this.month.month()>n.month()?(r+=" adjacent-month",r+=this.month.year()===n.year()?" last-month":" next-month"):this.month.month()<n.month()&&(r+=" adjacent-month",r+=this.month.year()===n.year()?" next-month":" last-month"),this.options.constraints&&(this.options.constraints.startDate&&n.isBefore(t(this.options.constraints.startDate))&&(r+=" inactive"),this.options.constraints.endDate&&n.isAfter(t(this.options.constraints.endDate))&&(r+=" inactive")),!n.isValid()&&n.hasOwnProperty("_d")&&n._d!=undefined&&(n=t(n._d)),r+=" calendar-day-"+n.format("YYYY-MM-DD"),r+=" calendar-dow-"+n.weekday(),this.calendarDay({day:n.date(),classes:this.options.targets.day+r,events:f,date:n})};i.prototype.render=function(){var r,n,i;this.calendarContainer.children().remove();var u=this.createDaysObject(this.month),e=this.month,f={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(u.length/7),days:u,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};if(this.options.render?this.calendarContainer.html(this.options.render.apply(this,[f])):this.calendarContainer.html(this.compiledClndrTemplate(f)),this.options.constraints){for(r in this.options.targets)r!=this.options.targets.day&&this.element.find("."+this.options.targets[r]).toggleClass("inactive",!1);n=null;i=null;this.options.constraints.startDate&&(n=t(this.options.constraints.startDate));this.options.constraints.endDate&&(i=t(this.options.constraints.endDate));n&&this.month.isSame(n,"month")&&this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",!0);i&&this.month.isSame(i,"month")&&this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",!0);n&&t(n).subtract(1,"years").isBefore(t(this.month).subtract(1,"years"))&&this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",!0);i&&t(i).add(1,"years").isAfter(t(this.month).add(1,"years"))&&this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",!0);(n&&n.isAfter(t(),"month")||i&&i.isBefore(t(),"month"))&&this.element.find("."+this.options.targets.today).toggleClass("inactive",!0)}this.options.doneRendering&&this.options.doneRendering.apply(this,[])};i.prototype.bindEvents=function(){var i=n(this.element),t=this;i.on("click","."+this.options.targets.day,function(i){if(t.options.clickEvents.click){var r=t.buildTargetObject(i.currentTarget,!0);t.options.clickEvents.click.apply(t,[r])}t.options.adjacentDaysChangeMonth&&(n(i.currentTarget).is(".last-month")?t.backActionWithContext(t):n(i.currentTarget).is(".next-month")&&t.forwardActionWithContext(t))});i.on("click","."+this.options.targets.empty,function(i){if(t.options.clickEvents.click){var r=t.buildTargetObject(i.currentTarget,!1);t.options.clickEvents.click.apply(t,[r])}t.options.adjacentDaysChangeMonth&&(n(i.currentTarget).is(".last-month")?t.backActionWithContext(t):n(i.currentTarget).is(".next-month")&&t.forwardActionWithContext(t))});i.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)};i.prototype.buildTargetObject=function(i,r){var u={element:i,events:[],date:null},e,f;return r&&(f=i.className.indexOf("calendar-day-"),f!==0?(e=i.className.substring(f+13,f+23),u.date=t(e)):u.date=null,this.options.events&&(u.events=this.options.multiDayEvents?n.makeArray(n(this.options.events).filter(function(){return(u.date.isSame(this._clndrStartDateObject,"day")||u.date.isAfter(this._clndrStartDateObject,"day"))&&(u.date.isSame(this._clndrEndDateObject,"day")||u.date.isBefore(this._clndrEndDateObject,"day"))})):n.makeArray(n(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==e})))),u};i.prototype.forwardAction=function(n){var t=n.data.context;t.forwardActionWithContext(t)};i.prototype.backAction=function(n){var t=n.data.context;t.backActionWithContext(t)};i.prototype.backActionWithContext=function(n){if(!n.element.find("."+n.options.targets.previousButton).hasClass("inactive")){var i=!n.month.isSame(t(n.month).subtract(1,"months"),"year");n.month.subtract(1,"months");n.render();n.options.clickEvents.previousMonth&&n.options.clickEvents.previousMonth.apply(n,[t(n.month)]);n.options.clickEvents.onMonthChange&&n.options.clickEvents.onMonthChange.apply(n,[t(n.month)]);i&&n.options.clickEvents.onYearChange&&n.options.clickEvents.onYearChange.apply(n,[t(n.month)])}};i.prototype.forwardActionWithContext=function(n){if(!n.element.find("."+n.options.targets.nextButton).hasClass("inactive")){var i=!n.month.isSame(t(n.month).add(1,"months"),"year");n.month.add(1,"months");n.render();n.options.clickEvents.nextMonth&&n.options.clickEvents.nextMonth.apply(n,[t(n.month)]);n.options.clickEvents.onMonthChange&&n.options.clickEvents.onMonthChange.apply(n,[t(n.month)]);i&&n.options.clickEvents.onYearChange&&n.options.clickEvents.onYearChange.apply(n,[t(n.month)])}};i.prototype.todayAction=function(n){var i=n.data.context,r=!i.month.isSame(t(),"month"),u=!i.month.isSame(t(),"year");i.month=t().startOf("month");i.options.clickEvents.today&&i.options.clickEvents.today.apply(i,[t(i.month)]);r&&(i.render(),i.month=t(),i.options.clickEvents.onMonthChange&&i.options.clickEvents.onMonthChange.apply(i,[t(i.month)]),u&&i.options.clickEvents.onYearChange&&i.options.clickEvents.onYearChange.apply(i,[t(i.month)]))};i.prototype.nextYearAction=function(n){var i=n.data.context;i.element.find("."+i.options.targets.nextYearButton).hasClass("inactive")||(i.month.add(1,"years"),i.render(),i.options.clickEvents.nextYear&&i.options.clickEvents.nextYear.apply(i,[t(i.month)]),i.options.clickEvents.onMonthChange&&i.options.clickEvents.onMonthChange.apply(i,[t(i.month)]),i.options.clickEvents.onYearChange&&i.options.clickEvents.onYearChange.apply(i,[t(i.month)]))};i.prototype.previousYearAction=function(n){var i=n.data.context;i.element.find("."+i.options.targets.previousYear).hasClass("inactive")||(i.month.subtract(1,"years"),i.render(),i.options.clickEvents.previousYear&&i.options.clickEvents.previousYear.apply(i,[t(i.month)]),i.options.clickEvents.onMonthChange&&i.options.clickEvents.onMonthChange.apply(i,[t(i.month)]),i.options.clickEvents.onYearChange&&i.options.clickEvents.onYearChange.apply(i,[t(i.month)]))};i.prototype.forward=function(n){return this.month.add(1,"months"),this.render(),n&&n.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),this.month.month()===0&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)])),this};i.prototype.back=function(n){return this.month.subtract(1,"months"),this.render(),n&&n.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),this.month.month()===11&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)])),this};i.prototype.next=function(n){return this.forward(n),this};i.prototype.previous=function(n){return this.back(n),this};i.prototype.setMonth=function(n,i){return this.month.month(n),this.render(),i&&i.withCallbacks&&this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),this};i.prototype.nextYear=function(n){return this.month.add(1,"year"),this.render(),n&&n.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this};i.prototype.previousYear=function(n){return this.month.subtract(1,"year"),this.render(),n&&n.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this};i.prototype.setYear=function(n,i){return this.month.year(n),this.render(),i&&i.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this};i.prototype.setEvents=function(n){return this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(n):this.addMomentObjectToEvents(n),this.render(),this};i.prototype.addEvents=function(t){return this.options.events=this.options.multiDayEvents?n.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(t)):n.merge(this.options.events,this.addMomentObjectToEvents(t)),this.render(),this};i.prototype.removeEvents=function(n){for(var t=this.options.events.length-1;t>=0;t--)n(this.options.events[t])==!0&&this.options.events.splice(t,1);return this.render(),this};i.prototype.addMomentObjectToEvents=function(n){var r=this,i=0,u=n.length;for(i;i<u;i++)n[i]._clndrDateObject=t(n[i][r.options.dateParameter]);return n};i.prototype.addMultiDayMomentObjectsToEvents=function(n){var r=this,i=0,u=n.length;for(i;i<u;i++)n[i]._clndrStartDateObject=t(n[i][r.options.multiDayEvents.startDate]),n[i]._clndrEndDateObject=t(n[i][r.options.multiDayEvents.endDate]);return n};i.prototype.calendarDay=function(t){var i={day:"",classes:this.options.targets.empty,events:[],date:null};return n.extend({},i,t)};n.fn.clndr=function(n){if(this.length===1){if(!this.data("plugin_clndr")){var t=new i(this,n);return this.data("plugin_clndr",t),t}}else if(this.length>1)throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.");}})