(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof exports=="object"?n(require("jquery")):n(jQuery)})(function(n){var t=navigator.userAgent,u=/iphone/i.test(t),f=/chrome/i.test(t),i=/android/i.test(t),r;n.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"};n.fn.extend({caret:function(n,t){var i;if(this.length!==0&&!this.is(":hidden"))return typeof n=="number"?(t=typeof t=="number"?t:n,this.each(function(){this.setSelectionRange?this.setSelectionRange(n,t):this.createTextRange&&(i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",n),i.select())})):(this[0].setSelectionRange?(n=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),n=0-i.duplicate().moveStart("character",-1e5),t=n+i.text.length),{begin:n,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,e){var y,l,o,c,h,a,s,p,v;return!t&&this.length>0?(y=n(this[0]),v=y.data(n.mask.dataName),v?v():undefined):(e=n.extend({autoclear:n.mask.autoclear,placeholder:n.mask.placeholder,completed:null},e),l=n.mask.definitions,o=[],c=s=t.length,h=null,n.each(t.split(""),function(n,t){t=="?"?(s--,c=n):l[t]?(o.push(new RegExp(l[t])),h===null&&(h=o.length-1),n<c&&(a=o.length-1)):o.push(null)}),this.trigger("unmask").each(function(){function tt(){if(e.completed){for(var n=h;n<=a;n++)if(o[n]&&y[n]===w(n))return;e.completed.call(v)}}function w(n){return n<e.placeholder.length?e.placeholder.charAt(n):e.placeholder.charAt(0)}function b(n){while(++n<s&&!o[n]);return n}function ft(n){while(--n>=0&&!o[n]);return n}function it(n,t){var r,i;if(!(n<0)){for(r=n,i=b(t);r<s;r++)if(o[r]){if(i<s&&o[r].test(y[i]))y[r]=y[i],y[i]=w(i);else break;i=b(i)}d();v.caret(Math.max(h,n))}}function et(n){for(var r,u,t=n,i=w(n);t<s;t++)if(o[t])if(r=b(t),u=y[t],y[t]=i,r<s&&o[r].test(u))i=u;else break}function ot(){var t=v.val(),n=v.caret(),i;if(t.length<p.length){for(k(!0);n.begin>0&&!o[n.begin-1];)n.begin--;if(n.begin===0)while(n.begin<h&&!o[n.begin])n.begin++;v.caret(n.begin,n.begin)}else{for(i=k(!0);n.begin<s&&!o[n.begin];)n.begin++;v.caret(n.begin,n.begin)}tt()}function rt(){k();v.val()!=nt&&v.change()}function st(n){if(!v.prop("readonly")){var i=n.which||n.keyCode,f,r,t;p=v.val();i===8||i===46||u&&i===127?(f=v.caret(),r=f.begin,t=f.end,t-r==0&&(r=i!==46?ft(r):t=b(r-1),t=i===46?b(t):t),g(r,t),it(r,t-1),n.preventDefault()):i===13?rt.call(this,n):i===27&&(v.val(nt),v.caret(0,k()),n.preventDefault())}}function ht(t){var f,r,u,e,h,c;v.prop("readonly")||(f=t.which||t.keyCode,r=v.caret(),t.ctrlKey||t.altKey||t.metaKey||f<32)||f&&f!==13&&(r.end-r.begin!=0&&(g(r.begin,r.end),it(r.begin,r.end-1)),u=b(r.begin-1),u<s&&(e=String.fromCharCode(f),o[u].test(e)&&(et(u),y[u]=e,d(),h=b(u),i?(c=function(){n.proxy(n.fn.caret,v,h)()},setTimeout(c,0)):v.caret(h),r.begin<=a&&tt())),t.preventDefault())}function g(n,t){for(var i=n;i<t&&i<s;i++)o[i]&&(y[i]=w(i))}function d(){v.val(y.join(""))}function k(n){for(var r=v.val(),u=-1,f,t=0,i=0;t<s;t++)if(o[t]){for(y[t]=w(t);i++<r.length;)if(f=r.charAt(i-1),o[t].test(f)){y[t]=f;u=t;break}if(i>r.length){g(t+1,s);break}}else y[t]===r.charAt(i)&&i++,t<c&&(u=t);return n?d():u+1<c?e.autoclear||y.join("")===ut?(v.val()&&v.val(""),g(0,s)):d():(d(),v.val(v.val().substring(0,u+1))),c?t:h}var v=n(this),y=n.map(t.split(""),function(n,t){if(n!="?")return l[n]?w(t):n}),ut=y.join(""),nt=v.val();v.data(n.mask.dataName,function(){return n.map(y,function(n,t){return o[t]&&n!=w(t)?n:null}).join("")});v.one("unmask",function(){v.off(".mask").removeData(n.mask.dataName)}).on("focus.mask",function(){if(!v.prop("readonly")){clearTimeout(r);var n;nt=v.val();n=k();r=setTimeout(function(){v.get(0)===document.activeElement&&(d(),n==t.replace("?","").length?v.caret(0,n):v.caret(n))},10)}}).on("blur.mask",rt).on("keydown.mask",st).on("keypress.mask",ht).on("input.mask paste.mask",function(){v.prop("readonly")||setTimeout(function(){var n=k(!0);v.caret(n);tt()},0)});if(f&&i)v.off("input.mask").on("input.mask",ot);k()}))}})})